# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
# FastAPI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –ú—ã
# –æ–±—Å—É–¥–∏–º, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã
# –¥–∞–Ω–Ω—ã—Ö –≤ FastAPI. FastAPI –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏–µ –∫–∞–∫ SQLite,
# PostgreSQL, MySQL –∏ MongoDB. –í—ã–±–æ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏
# –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞.
# –†–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã
# –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy ORM –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite.
# SQLite ‚Äî —ç—Ç–æ –æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞
# –æ—Å–Ω–æ–≤–µ SQL.
# –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–º –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É ORM (Object-Relational Mapping), —Ç–∞–∫—É—é –∫–∞–∫
# Tortoise ORM, SQLAlchemy –∏–ª–∏ Peewee.
# üî•–í–∞–∂–Ω–æ! –ï—Å–ª–∏ –≤—ã –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ SQLAlchemy –∏ databases —Ä–∞–Ω—å—à–µ,
# –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:
# pip install sqlalchemy
# pip install databases[aiosqlite]
# –í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º SQLAlchemy –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ
# –¥–∞–Ω–Ω—ã—Ö SQLite. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è DATABASE_URL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
# 8
# –°–æ–±—ã—Ç–∏–µ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –°–æ–±—ã—Ç–∏–µ
# –≤—ã–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —è–¥—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
# –ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –∑–º–µ–Ω–∏—Ç—å SQLite –Ω–∞ PostgreSQL, –¥–æ—Å—Ç–æ—Ç–æ—á–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤
# –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:
# DATABASE_URL = "postgresql://user:password@localhost/dbname"
# –£–∫–∞–∑–∞–≤ —Ç–∏–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–∞—Ä–æ–ª—å, —Ö–æ—Å—Ç –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
# –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–º —Å –Ω–µ–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

# –ü—Ä–∏–º–µ—Ä:

import databases
import sqlalchemy
from fastapi import FastAPI

DATABASE_URL = "sqlite:///mydatabase.db"
database = databases.Database(DATABASE_URL)
metadata = sqlalchemy.MetaData()

engine = sqlalchemy.create_engine(DATABASE_URL)
metadata.create_all(engine)

app = FastAPI()


@app.on_event("startup")
async def startup():
    await database.connect()


@app.on_event("shutdown")
async def shutdown():
    await database.disconnect()
